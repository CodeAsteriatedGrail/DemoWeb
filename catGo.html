<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<!-- style start -->
	<style>
		:root{
			--mapWidth: 50px;
			--mapHeigth: 50px;
		}
		
		body(
		background-color:black;
		margin: 5px;
		)
		
		/*FIXME:can't select .empty.chess.cat "
		and .empty not run*/{}
		.cat{
			float: left;
			background-color: red;
			position: absolute;
			width: var(--mapWidth);
			height: var(--mapHeigth);
		}
		button{border-radius: 50%;}
		.empty{
			float: left;
			background-color: gray;
			position: absolute;
			width: var(--mapWidth);
			height: var(--mapHeigth);
		}
		.chess{
			float: left;
			background-color: lightblue;
			position: absolute;
			width: var(--mapWidth);
			height: var(--mapHeigth);
		}
		#map{
			height:600px;
			background-color:lightyellow;
		}
		#tool{
			display: -webkit-flex;
			-webkit-flex-direction: row;
		}
	</style>
	<!-- style end -->

</head>
<!-- head end -->
<!-- body start -->
<body>
	
	<div id="map" class="map"></div>
	<div id="tool">
		<p>總共走了</p>
		<p id="count">0</p>
		<p>步</p><br/>
		<p>
		"em":"empty",
		"ch":"chess",
		"ca":"cat",</p>
	</div>
	<script>
	//設定檔
	var map = document.getElementById("map");
	var mapSize, chessSize,polySize;
	var catRow,catCol;
	var st="";
	var mapArr=[],mapArr2D=[];
	const mapData={
		"em":"empty",
		"ch":"chess",
		"ca":"cat",
	};
	
	mapSize=11;
	chessSize = 7;
	polySize=70;
	catRow=3;
	catCol=3;
	
	/**
	*
	*
	*/
	initMap();
	createMap();
	move();//加入下棋事件
	
	//catMove()
	function catMove(){
		var btn= map.querySelectorAll("button");
		console.log("cat now:",catRow,catCol);
		
		let catNow= catRow*11+ catCol;
		btn[catNow].setAttribute("class","empty");
		btn[catNow].setAttribute("onclick","chessDown(this)");
		
		let mi= parseInt((catRow%2)*2);
		let polyNei=[1,-1,10+mi,11,-11,-12+mi];
		
		let rand= Math.floor(Math.random()*6);
		//cat polyRange(1)
		let j=0;
		while(j<6){
			rand=(rand+j)%6;
			if(btn[catNow+polyNei[rand]].className=="empty"){
				
				btn[catNow+polyNei[rand]].setAttribute("class","cat");
				let arr =btn[catNow+polyNei[rand]].value.split(",");
				
				catRow= parseInt(arr[0]);
				catCol= parseInt(arr[1]);
				
				break;
			}
			j+=1;
			if(j==6){
				alert("you win");
			}
		}
		
		<!-- for(let i=0; i<6; ++i){ -->
			<!-- if(btn[catNow+polyNei[i]].className!="chess"){ -->
				<!-- btn[catNow+polyNei[i]].style.setProperty("background-color","lightpink"); -->
			<!-- } -->
		<!-- } -->
	}
	
	/**move(){
	*add onclick=chessDown();
	*}
	*/
	function move(){
		var cout= document.getElementById("count");
		var empMap= document.querySelectorAll(".empty");
		
		//add onclick
		for(let i=0; i<empMap.length; ++i){
			empMap[i].setAttribute("onclick","chessDown(this)");
		}
	}
	/**下棋觸發事件(){
	*change map
	* cat move}
	*/
	function chessDown(ev){
		let arr=[];
		arr= ev.value.split(",");
		let row= parseInt(arr[0]);
		let col= parseInt(arr[1]);
		console.log("chess move to:",arr[0],",",arr[1]);
		
		//地圖狀態改變
		ev.setAttribute("class","chess");
		count.innerHTML= parseInt(count.innerHTML)+1;
		mapArr2D[row][col]="ch";
		ev.innerHTML="ch";
		
		catMove();
	}
	
	/** initMap(){
	*建陣列()
	*地圖洗牌()
	*/
	function logMap(){
		console.log("data: 0:empty, 1:chess, 2:cat")
		for(let logi =0; logi<mapSize; ++logi){
			let rowTemp=logi*mapSize;
			console.log(mapArr.slice(rowTemp,rowTemp+mapSize));
		}
	}
	function initMap(){
		//建陣列
		console.log("create array:");
		for(let numi =0; numi<mapSize**2; numi++){
			if(numi<chessSize){
				mapArr.push("ch");}
			else{
			mapArr.push("em");}
		}
		logMap();
		
		//洗牌
		console.log("randMap:")
		for(let numi =mapArr.length-1; numi>0; --numi){
			let randInt = Math.floor(Math.random()*(numi+1));
			[mapArr[numi],mapArr[randInt]]=[mapArr[randInt],mapArr[numi]];
		}
		
		logMap();
	}
	
	/**createMap()
	*1D Array convert 2D
	*add map to html
	*/
	function createMap(){
		//1D Array convert 2D
		console.log("createMap:")
		for(let len=0; len<mapSize; ++len){
		mapArr2D.push(mapArr.splice(0,mapSize));
		}
		mapArr2D[catRow][catCol]="ca";
		console.log(mapArr2D);
		
		//add map
		for(let len=0; len<mapSize**2; ++len){
			let row = Math.floor(len/mapSize);
			let col = len%mapSize;
			let top = 10+row*polySize*(3/4);
			let left = 10+(row%2)*polySize/2+col*polySize*(3/4);
			
			map.innerHTML+=`<button
				class="${mapData[mapArr2D[row][col]]}"
				style="
					top:${top}px; 
					left:${left}px;"
					value="${row},${col}">
					${mapArr2D[row][col]}<br/>
					${row},${col}
				
				</button>`;
		}
	}	
	</script>
	
</body>
</html>