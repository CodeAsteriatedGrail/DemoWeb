<html>
	<head>
	<!-- style start -->
	<style>
		*{
		margin:5px;
		}

		#tool{
		background-color:lightblue;
		}

		.map{
		width:120px; 
		height:120px; 
		background-color: lightgray;
		display: grid;
		grid-template-columns: auto auto auto;
		}
		.map >button{
			width:30px;
			height:30px;
		}
		.boom{
			background-color: lightcoral;
		}
		.number{
			color: blue;
		}
		.empty{
			color: white;
		}
	</style>
	<!-- style end -->
	</head>
	
	<!-- body start -->
	<body >
	
	<table id="tool">
		<tr>
			<td>
			<p class="tool">地雷剩餘數量</p>
			</td>
			<td>
			<p class="tool">計時器</p>
			</td>
		</tr>
		<tr>
			<td>		
			<input type="text"></input>
			</td>
			<td>
			<input type="text"></input>
			</td>
		</tr>
	</table>
	
	<p>上帝視角</p>
	<div id="godmap" class="map" >
	</div>
	
	<p>主地圖</p>
	<div id="mainmap" class="map">
	</div>
	
</body>
<script>
<!-- 建立地圖 -->
	var map = document.getElementsByClassName("map");
	var mapsize;
	mapsize=3;
	
<!-- 放置炸彈 -->
	console.log("0:unknow 1:empty 2:number *:boom")
	var boommap=[],randmap=[],boom=[];	
	var boomi,boomj,boomnum;
	boomnum = 2;//炸彈數量
	
	// init
		//地圖初始化&放置炸彈
		for(let bi=0; bi<mapsize**2; bi++){
			randmap.push(0);
			if(bi<boomnum)randmap[bi]="*";//*=炸彈
		}
		//隨機整數
		function getRandInt(max){
		return Math.floor(Math.random()*max);
		}
	
	//隨機炸彈位置
		for (let numi=mapsize**2-1;numi>0;numi--){	
			let j = getRandInt(numi+1);
			[randmap[numi],randmap[j]]=[randmap[j],randmap[numi]]
			//console.log("numi:",numi,"j:",j)
		}
		//測試輸出
		randmap.forEach(function(item,index,array){
			//console.log("[",index,"]=",item); 
		});
		
	//把炸彈周圍更改數字
		//randmap 1d轉2d boommap
		for(let i=0; i<mapsize; i++){
			boommap.push(randmap.splice(0,mapsize));
		}
		
		//輸出地雷地圖
		boommap.forEach(function(item,index,array){
			console.log("[",index,"]=",item); 
		});
		
		//更改數字
		for(var newrow=0; newrow<mapsize; newrow++){
			boommap[newrow].forEach(function(item,index,array){
				if(item=="*"){
					console.log(newrow,index,array);
					trynum(newrow,index);
				}
				
			});
		}
		//數字處理
		function trynum(row,col){
			console.log("boom:",row,col)
			var rowi,coli;
			for(var rgnine=0;rgnine<9; rgnine++){
				rowi=row+Math.floor(rgnine/3)-1;
				coli=col+(rgnine%3)-1;
				
				if((-1<rowi)&&(rowi<mapsize)
				  &&(-1<coli)&&(coli<mapsize)
				  &&(boommap[rowi][coli]!=="*"))
				{
					console.log("add:",rowi,coli);
					boommap[rowi][coli]+=1;
				}
			
			}
		}
	//地圖完成
	for (let wd=0;wd<mapsize**2;wd++){
		let row =Math.floor(wd/mapsize);
		let col =wd%mapsize;
		var btnGod = document.createElement("button");
		var btnMain = document.createElement("button");
		
		//上帝視角
		btnGod.setAttribute('value',boommap[row][col]);
		btnGod.setAttribute('class',switchMap(boommap[row][col]));
		btnGod.innerText=boommap[row][col];
		map[0].appendChild(btnGod);
		
		//遊戲地圖
		btnMain.setAttribute('value',boommap[row][col]);
		btnMain.setAttribute('class',"unknow");
		btnMain.setAttribute('onclick',"game(this)");
		map[1].appendChild(btnMain);
		
	}
	//判斷地圖狀態
	function switchMap(ifmap){
		if(ifmap=="*")return "boom";
		if(ifmap==0)return "empty";
		return "number";
	}
	
	//遊戲
	function game(me){
		
		me.innerText=me.value;
		me.setAttribute('class',switchMap(me.value));
	}
	
</script>
</html>
